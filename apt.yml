---
- include_vars: vars.yml
- include_vars: ubuntu/vars.yml
- name: Add apt keys
  become: yes
  apt_key: keyserver={{ item.value.keyserver }} id={{ item.value.key }}
  with_dict: "{{ repositories }}"
  when: item.value.key is defined
- name: Add apt signing keys
  become: yes
  apt_key: url={{ item.value.key_url }} state=present
  with_dict: "{{ repositories }}"
  when: item.value.key_url is defined
- name: Add apt repositories
  become: yes
  apt_repository: repo={{ item.value.repository }}
  with_dict: "{{ repositories }}"
- name: Remove redundant packages
  become: yes
  apt:
    state: absent
    force_apt_get: yes
    update_cache: true
    name: "{{ remove_packages }}"
- name: Install packages
  become: yes
  apt:
    state: latest
    force_apt_get: yes
    update_cache: true
    name: "{{ install_packages }}"
